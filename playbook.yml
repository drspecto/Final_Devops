---
- name: Deploy React app on EC2
  hosts: all
  become: yes
  become_method: sudo
  become_user: root

  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install Node.js, npm and git
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - nodejs
        - npm
        - git

    - name: Clone your React app
      git:
        repo: 'https://github.com/deshraj-techhub/aws-devops-handson.git'
        dest: /home/ubuntu/app
        force: yes

    - name: Install dependencies
      shell: npm install
      args:
        chdir: /home/ubuntu/app

    - name: Start the app in background
      shell: nohup npm start > /dev/null 2>&1 &
      args:
        chdir: /home/ubuntu/app